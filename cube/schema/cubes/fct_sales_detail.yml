cubes:
  - name: fct_sales_detail
    sql_table: fedex_dwh_sales.fct_sales_detail
    data_source: default
    title: Sales

    joins:
      - name: dim_dates
        relationship: many_to_one
        sql: "{fct_sales_detail}.date_id = {dim_dates.id}"
      - name: dim_customers
        relationship: many_to_one
        sql: "{fct_sales_detail}.customer_id = {dim_customers.id}"
      - name: dim_products
        relationship: many_to_one
        sql: "{fct_sales_detail}.product_id = {dim_products.id}"
      - name: dim_stores
        relationship: many_to_one
        sql: "{fct_sales_detail}.store_id = {dim_stores.id}"

    dimensions:
      - name: id
        sql: id
        type: string
        primary_key: true

      - name: product_id
        sql: product_id
        type: string

      - name: customer_id
        sql: customer_id
        type: string

      - name: store_id
        sql: store_id
        type: string

      - name: sales_code
        sql: sales_code
        type: string

      - name: date
        sql: created_timestamp
        type: time

    measures:
      - name: count
        description: count of all sales
        type: count
      - name: amount
        sql: amount
        description: amt sum of all sales
        type: sum
      - name: average_amount
        description: Average amount per sale (total sales amt / quantity)
        sql: "{amount} / {count}"
        type: number
      # - name: rolling_total_amount
      #   description: rolling sum amount of all sales
      #   sql: amount
      #   type: sum
      #   rolling_window:
      #     trailing: unbounded

    pre_aggregations:
      # Pre-aggregation definitions go here.
      # Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started

      # - name: rollup_style_category_per_city
      #   description: Popular product style and category per (store) city, broken down by month.
      #   measures:
      #     - fct_sales_detail.count
      #   dimensions:
      #     - dim_products.category
      #     - dim_products.style
      #     - dim_stores.city
      #   # refreshKey:
      #   #   every: 1 hour
      #   timeDimension: fct_sales_detail.created_timestamp
      #   granularity: month

      # - name: number_of_sales_by_season_northern_hemisphere
      #   dimensions:
      #     - CUBE.status
      #   measures:
      #     - CUBE.count

      - name: amt_of_sales_by_season_northern_hemisphere
        dimensions:
          - dim_dates.season_northern_hemisphere
        measures:
          - CUBE.amount
        # time_dimension: CUBE.created_at
        # granularity: day
